version: "3.9"

services:
  mcp-gateway:
    ports:
      - "2092:2091"
    environment:
      ENVIRONMENT: "prod"
      DOCS_LOG_CHANNEL: "#cataclysm-deploys"
      SLACK_CHANNEL: "#cataclysm-deploys"

  docling-mcp:
    environment:
      DOCLING_MCP_ENVIRONMENT: production
      DOCLING_MCP_LOGGING__LEVEL: WARNING
      DOCLING_MCP_LOGGING__OUTPUT: /var/log/docling-mcp.log
      DOCLING_MCP_PERFORMANCE__TOOL_TIMEOUT: 30.0
      DOCLING_MCP_PERFORMANCE__MAX_CONNECTIONS: 200
      DOCLING_MCP_PERFORMANCE__RATE_LIMIT_REQUESTS: 500
      DOCLING_MCP_PERFORMANCE__RATE_LIMIT_WINDOW: 3600
      DOCLING_MCP_SECURITY__ENABLE_CORS: "true"
      DOCLING_MCP_SECURITY__ENABLE_RATE_LIMITING: "true"
      DOCLING_MCP_SECURITY__MAX_REQUEST_SIZE: 52428800
      DOCLING_MCP_DOCLING__MAX_FILE_SIZE: 52428800
      DOCLING_MCP_HEALTH_CHECK__INTERVAL: 60
      DOCLING_MCP_HEALTH_CHECK__TIMEOUT: 15
      DOCLING_MCP_HEALTH_CHECK__RETRIES: 5
      DOCLING_MCP_HEALTH_CHECK__START_PERIOD: 60
    volumes:
      - ./config/production.yaml:/srv/config/production.yaml:ro
      - docling_logs:/var/log
      - docling_data:/data
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '1'
          memory: 1G
    restart: unless-stopped

  crush-shim:
    ports:
      - "7070:7069"
    environment:
      ENVIRONMENT: "prod"
      DOCS_LOG_CHANNEL: "#cataclysm-deploys"
      SLACK_CHANNEL: "#cataclysm-deploys"

networks:
  docling_network:
    driver: bridge

volumes:
  docling_logs:
  docling_data: