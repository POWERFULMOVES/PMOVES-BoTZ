# Production docker-compose configuration for Docling MCP Server
# Usage: docker-compose -f docker-compose.mcp-pro.yml -f docker-compose.production.yml up docling-mcp

version: '3.8'

services:
  docling-mcp:
    environment:
      # Production-specific configuration overrides
      DOCLING_MCP_ENVIRONMENT: production
      DOCLING_MCP_LOGGING__LEVEL: WARNING
      DOCLING_MCP_LOGGING__OUTPUT: /var/log/docling-mcp.log
      DOCLING_MCP_PERFORMANCE__TOOL_TIMEOUT: 30.0
      DOCLING_MCP_PERFORMANCE__MAX_CONNECTIONS: 200
      DOCLING_MCP_PERFORMANCE__RATE_LIMIT_REQUESTS: 500
      DOCLING_MCP_PERFORMANCE__RATE_LIMIT_WINDOW: 3600
      DOCLING_MCP_SECURITY__ENABLE_CORS: "true"
      DOCLING_MCP_SECURITY__ENABLE_RATE_LIMITING: "true"
      DOCLING_MCP_SECURITY__MAX_REQUEST_SIZE: 52428800  # 50MB
      DOCLING_MCP_DOCLING__MAX_FILE_SIZE: 52428800  # 50MB
      DOCLING_MCP_HEALTH_CHECK__INTERVAL: 60
      DOCLING_MCP_HEALTH_CHECK__TIMEOUT: 15
      DOCLING_MCP_HEALTH_CHECK__RETRIES: 5
      DOCLING_MCP_HEALTH_CHECK__START_PERIOD: 60
    volumes:
      # Production volumes
      - ./config/production.yaml:/srv/config/production.yaml:ro
      - docling_logs:/var/log
      - docling_data:/data
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '1'
          memory: 1G
    restart: unless-stopped
    command: >
      sh -lc "
      echo 'Starting Docling MCP Server in PRODUCTION mode...' &&
      echo 'Configuration loaded from production environment' &&
      echo 'Security settings: CORS enabled, Rate limiting enabled' &&
      echo 'Performance settings: Max connections 200, Rate limit 500 req/hour' &&
      python docling_mcp_server.py --environment production
      "
    networks:
      - docling_network

networks:
  docling_network:
    driver: bridge

volumes:
  docling_logs:
  docling_data: